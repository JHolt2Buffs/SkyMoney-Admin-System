@page
@model SkyMoney_Admin_System.Pages_UserAccounts.DetailsModel

@{
    ViewData["Title"] = "User Details";
}

<h1>User Details</h1>

<div class="card mb-4">
    <div class="card-body">
        <h4 class="card-title">
            @Model.UserAccount.FirstName @Model.UserAccount.LastName
        </h4>
        <h6 class="card-subtitle text-muted mb-2">
            @Model.UserAccount.EmailAddress
        </h6>

        <dl class="row mb-0">
            <dt class="col-sm-3">Created At</dt>
            <dd class="col-sm-9">
                @Model.UserAccount.CreatedAt.ToShortDateString()
            </dd>

            <dt class="col-sm-3">Income Type</dt>
            <dd class="col-sm-9">
                @Model.UserAccount.IncomeType
            </dd>

            <dt class="col-sm-3">Next Scheduled Pay</dt>
            <dd class="col-sm-9">
                @(Model.UserAccount.NextScheduledPayDate?.ToShortDateString() ?? "N/A")
            </dd>

            <dt class="col-sm-3">Pay Frequency</dt>
            <dd class="col-sm-9">
                @Model.UserAccount.PayFrequencyLabel
            </dd>

            <dt class="col-sm-3">Has Scheduled Pay</dt>
            <dd class="col-sm-9">
                @Model.UserAccount.hasScheduledPay
            </dd>
        </dl>
    </div>
</div>

<h2>Budget Plans</h2>

@if (Model.UserAccount.BudgetPlans.Any())
{
    @foreach (var plan in Model.UserAccount.BudgetPlans)
    {
        <div class="card mb-3">
            <div class="card-header">
                <strong>@plan.PlanName</strong>
            </div>
            <div class="card-body">
                <p>
                    <strong>Total Budget:</strong> @plan.TotalBudget.ToString("C")<br />
                    <strong>Funded Fixed Expenses:</strong> @plan.FundedExpenses.ToString("C")<br />
                    <strong>Available Budget:</strong> @plan.AvailableBudget.ToString("C")
                </p>

                <h5>Fixed Expenses</h5>
                @if (plan.FixedExpenses.Any())
                {
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Amount</th>
                                <th>Funded</th>
                                <th>Due Date</th>
                                <th>Financed?</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var fx in plan.FixedExpenses)
                        {
                            <tr>
                                <td>@fx.Name</td>
                                <td>@fx.Amount.ToString("C")</td>
                                <td>@fx.FundedAmount.ToString("C")</td>
                                <td>@fx.DueDate.ToShortDateString()</td>
                                <td>@fx.IsFinanced</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">No fixed expenses for this plan.</p>
                }

                <h5>Variable Expenses</h5>
                @if (plan.VariableExpenses.Any())
                {
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>% of Available</th>
                                <th>Category Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var vx in plan.VariableExpenses)
                        {
                            <tr>
                                <td>@vx.CategoryName</td>
                                <td>@vx.PercentOfAvailableBudget %</td>
                                <td>@vx.CategoryBalance.ToString("C")</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">No variable expenses for this plan.</p>
                }
            </div>
        </div>
    }
}
else
{
    <p class="text-muted">This user has no budget plans.</p>
}

<h2>Income History</h2>

@if (Model.UserAccount.IncomeRecords.Any())
{
    <table class="table table-sm">
        <thead>
            <tr>
                <th>Date Received</th>
                <th>Amount</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var inc in Model.UserAccount.IncomeRecords.OrderByDescending(i => i.DateReceived))
        {
            <tr>
                <td>@inc.DateReceived.ToShortDateString()</td>
                <td>@inc.Amount.ToString("C")</td>
                <td>@inc.Notes</td>
            </tr>
        }
        </tbody>
    </table>
}
else
{
    <p class="text-muted">No income records for this user.</p>
}

<h2>Transactions</h2>

@if (Model.UserAccount.TransactionRecords.Any())
{
    <table class="table table-sm">
        <thead>
            <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Category</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var tr in Model.UserAccount.TransactionRecords.OrderByDescending(t => t.TransactionDate))
        {
            <tr>
                <td>@tr.TransactionDate.ToShortDateString()</td>
                <td>@tr.Amount.ToString("C")</td>
                <td>@tr.Category</td>
                <td>@tr.Description</td>
            </tr>
        }
        </tbody>
    </table>
}
else
{
    <p class="text-muted">No transactions for this user.</p>
}

<div class="mt-3">
    <a asp-page="./Edit" asp-route-id="@Model.UserAccount.UserAccountId" class="btn btn-primary">Edit User</a>
    <a asp-page="./Index" class="btn btn-secondary">Back to List</a>
</div>
